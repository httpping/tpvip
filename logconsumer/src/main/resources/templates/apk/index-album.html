<!doctype html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script th:src="@{/static/js/qrcode.min.js}"></script>
    <link  rel="stylesheet" th:href="@{/static/css/album.css}"></link>

    <!-- Bootstrap CSS -->
    <!--<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">-->

    <title>移动组的日志系统</title>

</head>
<body>
<header th:include="/common::header"></header>

<!--
<input type="text"  id="platform_name" class="form-control" placeholder="平台过滤:" aria-label="平台过滤:" />
<button onclick="clearLog()" type="button" class="btn btn-dark">清除历史日志(默认所有)</button>
-->

<main role="main">
    <section class="jumbotron text-center" style="background-color: white">
        <div class="container">
            <h1 class="jumbotron-heading">APK 管理</h1>
            <p class="lead text-muted">提供jenkins打包下载等</p>
            <p>
                <a href="/apk" class="btn btn-primary my-2">管理列表</a>
            </p>
        </div>
    </section>

    <div class="album py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-md-4" th:each="apk ,apkStat: ${models}">
                    <div class="card mb-4 box-shadow">
                        <img class="card-img-top"  th:data-src="${'holder.js/100px225?theme=thumb&amp;bg=fff&amp;fg=eceeef&amp;text=' + apk.name }" th:alt="${apk.name + '[100%x225]'}" style="height: 225px; width: 100%; display: block;" th:src="${'data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22348%22%20height%3D%22225%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20348%20225%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_167a574affe%20text%20%7B%20fill%3A%23eceeef%3Bfont-weight%3Abold%3Bfont-family%3AArial%2C%20Helvetica%2C%20Open%20Sans%2C%20sans-serif%2C%20monospace%3Bfont-size%3A17pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_167a574affe%22%3E%3Crect%20width%3D%22348%22%20height%3D%22225%22%20fill%3D%22%2355595c%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%22116.7265625%22%20y%3D%22120.3%22%3E'+apk.name +'(' + apk.number+')'+'%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E'}" data-holder-rendered="true">
                        <div class="card-body">
                            <!--<p class="card-text" th:text="${apk.name +' ('+ apk.number + ')' }">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>-->
                            <p  class="card-text" style="color: #4e555b" th:text="${'更新日志：<br/>' + apk.changeLog!=null?apk.changeLog:'无'}">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group">

                                    <!--<a  th:style="${isDetail} ? 'display:none':''" th:href="${ '/apk/' + apk.name}"  class="btn btn-info btn-sm">详情</a>-->
                                    <button type="button" class="btn btn-sm btn-outline-secondary"  data-toggle="modal" data-target="#myModal" th:onclick="|showQr(${apk.number},'${apk.name}','${apk.path}','${apk.fileName}','${#dates.format(apk.updateTime, 'yyyy-MM-dd hh:mm:ss')}')|">下载</button>
                                    <a  class="btn btn-sm btn-outline-secondary" th:href="${ '/apk/' + apk.name}">详情</a>

                                </div>
                                <small class="text-muted"th:text="${#dates.format(apk.updateTime, 'yyyy-MM-dd hh:mm:ss')}"> </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main>



<div id="myModal" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="card text-center">
                <div class="card-header">
                    <h5 id="title_name" class="card-title">Card title</h5>
                </div>
                <div class="card-body">
                    <h5 class="card-title " >二维码</h5>
                    <div align="center" style="text-align: center;margin:0 auto; width: 256px;height: 256px;background-color: #0b2e13">
                        <div id="qrcode"  align="center" class="text-center"> </div>
                    </div>
                    <p  id="file_name" class="card-text" style="margin-top: 10px">With supporting text below as a natural lead-in to additional content.</p>
                    <a id="a_down"  href="#" class="btn btn-primary">立即下载</a>
                </div>
                <div class="card-footer text-muted">
                    <p  id="apk_number" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="text-muted">
    <div class="container">
        <p class="float-right">
            <a href="/apk/album">Back to top</a>
        </p>
        <p>APK download is © 移动组</p>
        <!--<p>New to Bootstrap? <a href="https://getbootstrap.com/docs/4.0/">Visit the homepage</a> or read our <a href="https://getbootstrap.com/docs/4.0/getting-started/">getting started guide</a>.</p>-->
    </div>
</footer>


<script type="text/javascript">


    function showQr(number,name,path,filename,updateTime) {

        var url = "http://10.32.2.200:8080/jenkins/job/" + name +"/"+number +"/artifact/" + path;
        // alert(url)
        $('#qrcode').html(null);
        var qrcode = new QRCode('qrcode', {
            text: url,
            width: 256,
            height: 256,
            colorDark : '#000000',
            colorLight : '#ffffff',
            correctLevel : QRCode.CorrectLevel.H
        });

        $('#apk_url').html(url)
        $('#title_name').html(name)
        $('#file_name').html(filename)
        $('#apk_number').html(updateTime)


        // $('#apk_download').href(url)

        $('#a_down').attr('href',url);
        $('#a_down').attr('download',name);

        $('#myModal').modal('show')



    }



</script>


</body>
</html>

